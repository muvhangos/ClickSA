<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ClickSA | Live South African News & Events</title>
<meta name="description" content="ClickSA â€” live South African news, events, entertainment and local insights.">
<style>
:root{--accent:#00b74a;--accent2:#007bff;--accent3:#ffcc00;--bg:#f8f9fa;--card:#fff}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#222}
header{display:flex;align-items:center;gap:10px;justify-content:center;padding:14px 16px;background:linear-gradient(90deg,var(--accent2),var(--accent),var(--accent3));color:#fff;position:relative}
.site-title{font-weight:700;font-size:1.25rem}
.logo-icon{width:25px;height:18px;border-radius:3px;object-fit:cover;animation:spin 6s linear infinite;}
.click-icon{display:inline-block;margin-left:8px;animation:clickMove 1s infinite;}
@keyframes spin{from{transform:rotateY(0);}to{transform:rotateY(360deg);}}
@keyframes clickMove{0%{transform:translateY(0);}50%{transform:translateY(-5px);}100%{transform:translateY(0);}}
#breakingNews{position:absolute;bottom:-24px;width:100%;overflow:hidden;background:var(--accent3);color:#222;font-weight:600;padding:6px 0;white-space:nowrap}
#breakingNewsContent{display:inline-block;padding-left:100%;white-space:nowrap;animation:scrollTicker 30s linear infinite}
@keyframes scrollTicker{0%{transform:translateX(0)}100%{transform:translateX(-100%)}}
nav{display:flex;gap:12px;justify-content:center;background:#222;padding:10px;flex-wrap:wrap}
nav button{background:none;border:none;color:#fff;cursor:pointer;padding:8px 10px;font-size:0.95rem}
nav button.active{border-bottom:2px solid var(--accent3);color:var(--accent3)}
main{max-width:1200px;margin:48px auto 18px;padding:0 14px}
h2{margin:0;font-size:1.2rem;margin-bottom:8px}

/* Carousel Styles */
.carousel-wrap {position:relative;overflow:hidden;width:100%;display:flex;align-items:center;height:220px;margin-bottom:20px;}
.carousel-track {display:flex;transition:transform 0.8s ease-in-out;}
.carousel-card {min-width:300px;margin-right:16px;flex-shrink:0;background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column;}
.carousel-card img {width:100%;height:180px;object-fit:cover;}
.carousel-card .content {padding:12px;}
.carousel-card .title {font-weight:700;margin-bottom:6px;font-size:1rem;}
.carousel-card .desc {color:#555;font-size:0.92rem;line-height:1.2;max-height:3.6em;overflow:hidden;}
.carousel-card .actions a {color:var(--accent2);text-decoration:none;font-weight:600;font-size:0.92rem;}

/* Event Cards */
.cards{display:flex;flex-wrap:wrap;gap:12px;justify-content:center}
.cards .card-inner{background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column}
.cards img{width:100%;height:180px;object-fit:cover}
.cards .content{padding:12px}
.cards .title{font-weight:700;margin-bottom:8px;font-size:1rem}
.cards .desc{color:#555;font-size:0.92rem;line-height:1.2;max-height:3.6em;overflow:hidden}
.cards .actions a{color:var(--accent2);text-decoration:none;font-weight:600}

/* Admin Panel */
#adminPanel{display:none;padding:12px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin:12px 0}
.show-admin{display:block}

footer{margin-top:18px;padding:18px;background:#222;color:#fff;text-align:center;font-size:0.9rem}
</style>
</head>
<body>

<header>
  <div class="site-title">ClickSA</div>
  <span class="click-icon">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
      <path d="M2 21h2V9.414l5.293 5.293 1.414-1.414L6 7.586V3h2v4.586l4.293 4.293 1.414-1.414L10 5.586V3h2v7.586l4 4V5h2v11.586l3.707 3.707-1.414 1.414L2 5V21z"/>
    </svg>
  </span>
  <img class="logo-icon" src="https://upload.wikimedia.org/wikipedia/commons/a/af/Flag_of_South_Africa.svg" alt="SA Flag">
  <div id="breakingNews"><div id="breakingNewsContent">Loading breaking news...</div></div>
</header>

<nav>
  <button class="active" data-cat="general" onclick="handleNav(event)">General</button>
  <button data-cat="business" onclick="handleNav(event)">Business</button>
  <button data-cat="sports" onclick="handleNav(event)">Sports</button>
  <button data-cat="entertainment" onclick="handleNav(event)">Entertainment</button>
  <button data-cat="events" onclick="handleNav(event)">Events</button>
</nav>

<main>
  <!-- Carousel for Top Headlines -->
  <section>
    <h2>Top Headlines</h2>
    <div class="carousel-wrap">
      <div class="carousel-track" id="carouselTrack"></div>
    </div>
  </section>

  <!-- Events Section -->
  <section>
    <h2>Events & Entertainment</h2>
    <div class="cards" id="eventsCards"></div>
  </section>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <h3>Admin â€” Revenue Simulator (ZAR)</h3>
    <div style="display:flex;gap:12px;align-items:center">
      <label>Daily visitors: <input id="adminVisitors" type="number" value="3000" style="width:120px;margin-left:8px"></label>
      <button onclick="runRevenueCalc()">Calculate & Email</button>
    </div>
    <div style="margin-top:12px">
      <strong>Estimated Daily:</strong> ZAR <span id="adminDaily">0</span> &nbsp; â€¢ &nbsp;
      <strong>Estimated Monthly:</strong> ZAR <span id="adminMonthly">0</span>
    </div>
  </div>
</main>

<footer>
  &copy; 2025 ClickSA â€¢ Contact: muvhangos@gmail.com
</footer>

<script>
// === Optimized JS ===
const FALLBACK_IMG='https://via.placeholder.com/800x450?text=ClickSA';
const RSS_FEEDS={
  general:['https://www.news24.com/rss','https://ewn.co.za/RSS'],
  business:['https://www.businesslive.co.za/bd/rss/','https://businesstech.co.za/feed/'],
  sports:['https://www.sport24.co.za/RSS','https://www.bbc.co.uk/sport/africa/rss.xml'],
  entertainment:['https://www.channel24.co.za/rss','https://www.iol.co.za/entertainment/rss'],
  events:['https://www.capetownmagazine.com/rss','https://www.joburg.co.za/feed/']
};

const feedCache={};

async function fetchFeed(url){
  if(feedCache[url]) return feedCache[url];
  try{
    const resp=await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`, {cache:'no-store'});
    const json=await resp.json();
    const items=(json.items||[]).map(it=>({
      title: it.title||'',
      link: it.link||'#',
      description:(it.description||it.content||'').replace(/(<([^>]+)>)/gi,''),
      pubDate: it.pubDate||'',
      thumbnail:(it.thumbnail||it.enclosure&&it.enclosure.link)||FALLBACK_IMG
    }));
    feedCache[url]=items;
    return items;
  }catch(e){ return []; }
}

async function loadAllFeeds(cat){
  const feeds=RSS_FEEDS[cat]||[];
  const results = await Promise.allSettled(feeds.map(fetchFeed));
  let items=[];
  results.forEach(r=>{if(r.status==='fulfilled') items = items.concat(r.value)});
  return items;
}

// Carousel
const carouselTrack = document.getElementById('carouselTrack');
let carouselIndex=0;
async function loadCarousel(){
  const items = await loadAllFeeds('general');
  carouselTrack.innerHTML='';
  items.slice(0,12).forEach(it=>{
    const card=document.createElement('div');
    card.className='carousel-card';
    card.innerHTML=`<img src="${it.thumbnail}" alt="">
                    <div class="content">
                      <div class="title">${it.title}</div>
                      <div class="desc">${it.description}</div>
                      <div class="actions"><a href="${it.link}" target="_blank">Read full story</a></div>
                    </div>`;
    carouselTrack.appendChild(card);
  });
  if(items.length<2) return;
  setInterval(()=>{
    carouselIndex++;
    if(carouselIndex >= items.length) carouselIndex=0;
    const cardWidth = carouselTrack.querySelector('.carousel-card').offsetWidth + 16;
    carouselTrack.style.transform=`translateX(-${carouselIndex * cardWidth}px)`;
  },10000);
}

// Events
const eventsContainer=document.getElementById('eventsCards');
async function loadEvents(){
  const items = await loadAllFeeds('events');
  eventsContainer.innerHTML='';
  items.slice(0,12).forEach(it=>{
    const card=document.createElement('div');
    card.className='card-inner';
    card.innerHTML=`<img src="${it.thumbnail}" alt="">
                    <div class="content">
                      <div class="title">${it.title}</div>
                      <div class="desc">${it.description}</div>
                      <div class="actions"><a href="${it.link}" target="_blank">View Event</a></div>
                    </div>`;
    eventsContainer.appendChild(card);
  });
}

// Breaking News Ticker
const breakingTicker=document.getElementById('breakingNewsContent');
async function loadBreakingNews(){
  const allFeeds = Object.keys(RSS_FEEDS).flatMap(cat=>RSS_FEEDS[cat]);
  const allItems=(await Promise.all(allFeeds.map(fetchFeed))).flat();
  breakingTicker.innerText = allItems.slice(0,15).map(i=>`ðŸŽ‰ ${i.title}`).join('  â€¢  ');
}

// Admin
function parseQuery(){return new URLSearchParams(location.search).get('adminKey')||'';}
function showAdminIfNeeded(){if(parseQuery()==='supersecret'){document.getElementById('adminPanel').classList.add('show-admin');document.getElementById('adminPanel').style.display='block';}}
function runRevenueCalc(){const visitors=parseInt(document.getElementById('adminVisitors').value)||0;const pageviewsPerVisitor=2.5;const adsPerPage=4;const ctr=0.01;const cpc=2;const monthlyDays=30;const monthlyPageviews=visitors*pageviewsPerVisitor*monthlyDays;const impressions=monthlyPageviews*adsPerPage;const clicks=impressions*ctr;const monthlyRevenue=clicks*cpc;const dailyRevenue=monthlyRevenue/monthlyDays;document.getElementById('adminDaily').innerText=dailyRevenue.toFixed(2);document.getElementById('adminMonthly').innerText=monthlyRevenue.toFixed(2);}

// Navigation
function handleNav(e){
  const btn=e.currentTarget;
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const cat=btn.dataset.cat;
  if(cat==='events'){loadEvents();}else{loadCarousel();}
}

// Boot
(async function boot(){
  showAdminIfNeeded();
  await Promise.all([loadCarousel(),loadEvents(),loadBreakingNews()]);
})();
</script>
</body>
</html>
