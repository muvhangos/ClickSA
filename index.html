<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ClickSA | Live South African Headlines & Events</title>
<meta name="description" content="ClickSA — live South African news, events, entertainment and local insights." />
<style>
  :root{--accent:#00b74a;--accent2:#007bff;--accent3:#ffcc00;--bg:#f8f9fa;--card:#fff}
  *{box-sizing:border-box}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; margin:0;background:var(--bg);color:#222}
  header{display:flex;align-items:center;gap:10px;justify-content:center;padding:14px 16px;background:linear-gradient(90deg,var(--accent2),var(--accent),var(--accent3));color:#fff}
  .site-title{font-weight:700;font-size:1.25rem}
  .logo-icon{width:35px;height:25px;border-radius:3px;object-fit:cover}
  nav{display:flex;gap:12px;justify-content:center;background:#222;padding:10px;flex-wrap:wrap}
  nav button{background:none;border:none;color:#fff;cursor:pointer;padding:8px 10px;font-size:0.95rem}
  nav button.active{border-bottom:2px solid var(--accent3);color:var(--accent3)}
  main{max-width:1200px;margin:18px auto;padding:0 14px}
  .section-head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:8px}
  h2{margin:0;font-size:1.2rem}
  .carousel-wrap{position:relative;min-height:220px;display:block}
  .cards{position:relative;height:100%;display:block}
  .card{position:absolute;left:0;top:0;width:100%;opacity:0;transition:opacity .8s ease;display:flex;gap:0;align-items:stretch}
  .card.visible{opacity:1;z-index:2}
  .card-inner{background:var(--card);border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column;width:100%}
  .card img{width:100%;height:180px;object-fit:cover;display:block}
  .card .content{padding:12px}
  .title{font-weight:700;margin-bottom:8px;font-size:1rem}
  .desc{color:#555;font-size:0.92rem;line-height:1.2;max-height:3.6em;overflow:hidden}
  .meta{font-size:0.82rem;color:#888;margin-top:8px}
  .actions{margin-top:10px}
  .actions a{color:var(--accent2);text-decoration:none;font-weight:600}
  /* nav arrows (optional) */
  .carousel-controls{position:absolute;inset:0;pointer-events:none}
  .carousel-controls button{pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.35);border:none;color:#fff;padding:8px;border-radius:999px;cursor:pointer}
  .carousel-controls button.left{left:10px}
  .carousel-controls button.right{right:10px}
  /* small responsive */
  @media(min-width:720px){
    .card{display:flex}
    .card img{width:45%;height:220px}
    .card .content{width:55%}
  }

  /* Events grid (carousel uses same classes) */
  .events-wrap{margin-top:18px}
  .small-meta{font-size:0.85rem;color:#666}

  /* admin dashboard hidden by default */
  #adminPanel{display:none;padding:12px;background:#fff;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin:12px 0}
  .revenue-sim{display:none}
  /* show when admin key is present */
  .show-admin{display:block}
  /* footer */
  footer{margin-top:18px;padding:18px;background:#222;color:#fff;text-align:center;font-size:0.9rem}
</style>
</head>
<body>

<header>
  <div class="site-title">ClickSA</div>
  <img class="logo-icon" src="https://upload.wikimedia.org/wikipedia/commons/a/af/Flag_of_South_Africa.svg" alt="SA Flag">
</header>

<nav>
  <button class="active" data-cat="general" onclick="handleNav(event)">General</button>
  <button data-cat="business" onclick="handleNav(event)">Business</button>
  <button data-cat="sports" onclick="handleNav(event)">Sports</button>
  <button data-cat="entertainment" onclick="handleNav(event)">Entertainment</button>
  <button data-cat="events" onclick="handleNav(event)">Events</button>
</nav>

<main>
  <!-- NEWS -->
  <section aria-labelledby="news-title">
    <div class="section-head">
      <h2 id="news-title">Top Headlines</h2>
      <div class="small-meta">Live feed — updates every 5 minutes</div>
    </div>

    <div class="carousel-wrap" id="newsCarousel" onmouseenter="pauseCarousel('news')" onmouseleave="resumeCarousel('news')">
      <div class="cards" id="newsCards"></div>
      <div class="carousel-controls">
        <button class="left" onclick="prevSlide('news')">◀</button>
        <button class="right" onclick="nextSlide('news')">▶</button>
      </div>
    </div>
  </section>

  <!-- EVENTS / ENTERTAINMENT -->
  <section class="events-wrap" aria-labelledby="events-title" style="margin-top:22px">
    <div class="section-head">
      <h2 id="events-title">Events & Entertainment</h2>
      <div class="small-meta">Local concerts, festivals & lifestyle events</div>
    </div>

    <div class="carousel-wrap" id="eventsCarousel" onmouseenter="pauseCarousel('events')" onmouseleave="resumeCarousel('events')">
      <div class="cards" id="eventsCards"></div>
      <div class="carousel-controls">
        <button class="left" onclick="prevSlide('events')">◀</button>
        <button class="right" onclick="nextSlide('events')">▶</button>
      </div>
    </div>
  </section>

  <!-- Admin dashboard (visible only with adminKey query) -->
  <div id="adminPanel">
    <h3>Admin — Revenue Simulator (ZAR)</h3>
    <div style="display:flex;gap:12px;align-items:center">
      <label>Daily visitors: <input id="adminVisitors" type="number" value="3000" style="width:120px;margin-left:8px"></label>
      <button onclick="runRevenueCalc()">Calculate & Email</button>
    </div>
    <div style="margin-top:12px">
      <strong>Estimated Daily:</strong> ZAR <span id="adminDaily">0</span> &nbsp; • &nbsp;
      <strong>Estimated Monthly:</strong> ZAR <span id="adminMonthly">0</span>
    </div>
    <div style="margin-top:12px;color:#666">Emails are sent using EmailJS — replace placeholders with your IDs in the script.</div>
  </div>

</main>

<footer>
  &copy; 2025 ClickSA • Local news, events & entertainment • Contact: muvhangos@gmail.com
</footer>

<!-- EmailJS library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>
/* =========================
   Configuration
   - Update EmailJS IDs below before deploying
   - You can change adminKey to your own secret
   ========================= */
const EMAILJS_USER_ID = 'YOUR_EMAILJS_USER_ID';
const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';
const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';
const ADMIN_KEY = 'supersecret'; // change if desired

// Initialize EmailJS (client-side)
if(typeof emailjs !== 'undefined' && EMAILJS_USER_ID && EMAILJS_USER_ID !== 'YOUR_EMAILJS_USER_ID'){
  emailjs.init(EMAILJS_USER_ID);
}

/* -------------------------
   RSS sources (mix includes entertainment/events)
   You can add/remove feeds as you like.
   ------------------------- */
const RSS_FEEDS = {
  general: [
    'https://www.news24.com/rss',
    'https://ewn.co.za/RSS'
  ],
  business: [
    'https://www.businesslive.co.za/bd/rss/',
    'https://businesstech.co.za/feed/'
  ],
  sports: [
    'https://www.sport24.co.za/RSS',
    'https://www.bbc.co.uk/sport/africa/rss.xml'
  ],
  entertainment: [
    'https://www.channel24.co.za/rss', // contains entertainment
    'https://www.iol.co.za/entertainment/rss'
  ],
  events: [
    'https://www.capetownmagazine.com/rss',
    'https://www.joburg.co.za/feed/' // may provide events listing
  ]
};

/* -------------------------
   Fallback images & settings
   ------------------------- */
const FALLBACK_IMG = 'https://via.placeholder.com/800x450?text=ClickSA';
const ROTATE_INTERVAL_MS = 10000; // 10s
const REFRESH_FEEDS_MS = 5 * 60 * 1000; // refresh feeds every 5 minutes
const RSS2JSON = url => `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(url)}`;

/* -------------------------
   Carousel state
   ------------------------- */
const state = {
  news: { items: [], index: 0, timer: null, paused: false },
  events: { items: [], index: 0, timer: null, paused: false }
};

/* -------------------------
   Helpers: fetch RSS (rss2json)
   ------------------------- */
async function fetchFeedUrl(url){
  try{
    const resp = await fetch(RSS2JSON(url), {cache: "no-store"});
    if(!resp.ok) throw new Error('network');
    const json = await resp.json();
    return (json.items || []).map(it => ({
      title: it.title || '',
      link: it.link || '#',
      description: (it.description || it.content || '').replace(/(<([^>]+)>)/gi, ''),
      pubDate: it.pubDate || '',
      thumbnail: (it.thumbnail || it.enclosure && it.enclosure.link) || FALLBACK_IMG
    }));
  }catch(e){
    console.warn('feed failed', url, e);
    return [];
  }
}

async function loadFeedsForCategory(cat){
  const feeds = RSS_FEEDS[cat] || [];
  let items = [];
  for(const f of feeds){
    const got = await fetchFeedUrl(f);
    items = items.concat(got);
  }
  // shuffle a bit for variety
  items = items.sort(()=>Math.random()-0.5);
  return items;
}

/* -------------------------
   Render functions
   ------------------------- */
function renderCarousel(targetId, listKey){
  const container = document.getElementById(targetId);
  container.innerHTML = '';
  const items = state[listKey].items;
  if(!items || items.length === 0){
    const nof = document.createElement('div');
    nof.className = 'card visible';
    nof.innerHTML = `<div class="card-inner"><div class="card"><div class="card-inner"><div class="content" style="padding:20px"><div class="title">No items available</div><div class="desc">Feed failed or no items. Try again later.</div></div></div></div>`;
    container.appendChild(nof);
    return;
  }
  items.forEach((it, idx) => {
    const card = document.createElement('div');
    card.className = 'card' + (idx === state[listKey].index ? ' visible' : '');
    const inner = document.createElement('div');
    inner.className = 'card-inner';
    inner.innerHTML = `
      <img src="${it.thumbnail || FALLBACK_IMG}" alt="">
      <div class="content">
        <div class="title">${it.title}</div>
        <div class="desc">${it.description || ''}</div>
        <div class="meta">${it.pubDate ? new Date(it.pubDate).toLocaleString() : ''}</div>
        <div class="actions"><a href="${it.link}" target="_blank" rel="noopener">Read full story</a></div>
      </div>`;
    card.appendChild(inner);
    container.appendChild(card);
  });
}

/* -------------------------
   Carousel controls: rotate, next, prev, pause, resume
   ------------------------- */
function startCarousel(key){
  stopCarousel(key);
  state[key].timer = setInterval(()=> {
    if(!state[key].paused && state[key].items.length > 0){
      nextSlide(key);
    }
  }, ROTATE_INTERVAL_MS);
}
function stopCarousel(key){
  if(state[key].timer) { clearInterval(state[key].timer); state[key].timer = null; }
}
function pauseCarousel(key){ state[key].paused = true; }
function resumeCarousel(key){ state[key].paused = false; }
function nextSlide(key){
  const len = state[key].items.length;
  if(len === 0) return;
  state[key].index = (state[key].index + 1) % len;
  updateVisibleCard(key);
}
function prevSlide(key){
  const len = state[key].items.length;
  if(len === 0) return;
  state[key].index = (state[key].index - 1 + len) % len;
  updateVisibleCard(key);
}
function updateVisibleCard(key){
  const container = (key === 'news') ? document.getElementById('newsCards') : document.getElementById('eventsCards');
  const cards = container.querySelectorAll('.card');
  cards.forEach((c,i)=>{
    c.classList.toggle('visible', i === state[key].index);
  });
}

/* -------------------------
   Load & initialize both carousels
   ------------------------- */
async function initCarousel(key, targetId, feedCategory){
  // load items
  const items = await loadFeedsForCategory(feedCategory);
  state[key].items = items;
  state[key].index = 0;
  renderCarousel(targetId, key);
  startCarousel(key);
}

/* -------------------------
   Periodic refresh of feed data
   ------------------------- */
async function refreshAll(){
  await initCarousel('news', 'newsCards', 'general');
  // also load business and sports behind the scenes and merge for variety
  const business = await loadFeedsForCategory('business');
  const sports = await loadFeedsForCategory('sports');
  // mix them in the news list for more variety
  state.news.items = state.news.items.concat(business).concat(sports).sort(()=>Math.random()-0.5).slice(0,20);
  renderCarousel('newsCards', 'news'); // re-render
  startCarousel('news');

  // events + entertainment
  const ent = await loadFeedsForCategory('entertainment');
  const events = await loadFeedsForCategory('events');
  state.events.items = ent.concat(events).sort(()=>Math.random()-0.5).slice(0,16);
  state.events.index = 0;
  renderCarousel('eventsCards', 'events');
  startCarousel('events');
}

/* -------------------------
   Nav handler
   ------------------------- */
function handleNav(e){
  const btn = e.currentTarget;
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const cat = btn.dataset.cat;
  // if user selected a feed category (general/business/sports/entertainment) show a filtered news list
  (async ()=>{
    if(cat === 'events'){
      // focus events carousel area (no change)
      document.getElementById('eventsCarousel').scrollIntoView({behavior:'smooth'});
    } else {
      // load that feed into the news carousel
      const items = await loadFeedsForCategory(cat);
      state.news.items = items.length ? items : state.news.items;
      state.news.index = 0;
      renderCarousel('newsCards', 'news');
      startCarousel('news');
      document.getElementById('newsCarousel').scrollIntoView({behavior:'smooth'});
    }
  })();
}

/* -------------------------
   Revenue simulator (admin)
   - calculates ZAR estimates, shows dashboard when adminKey found
   - sends email using EmailJS (client-side)
   ------------------------- */
function parseQuery(){
  const q = new URLSearchParams(location.search);
  return q.get('adminKey') || '';
}
function showAdminIfNeeded(){
  const key = parseQuery();
  if(key === ADMIN_KEY){
    document.getElementById('adminPanel').classList.add('show-admin');
    document.getElementById('adminPanel').style.display = 'block';
  }
}
function runRevenueCalc(){
  const visitors = parseInt(document.getElementById('adminVisitors').value) || 0;
  const pageviewsPerVisitor = 2.5;
  const adsPerPage = 4;
  const ctr = 0.01; // 1%
  const cpc = 2; // ZAR per click (estimate)
  const monthlyDays = 30;

  const monthlyPageviews = visitors * pageviewsPerVisitor * monthlyDays;
  const impressions = monthlyPageviews * adsPerPage;
  const clicks = impressions * ctr;
  const monthlyRevenue = clicks * cpc;
  const dailyRevenue = monthlyRevenue / monthlyDays;

  document.getElementById('adminDaily').innerText = dailyRevenue.toFixed(2);
  document.getElementById('adminMonthly').innerText = monthlyRevenue.toFixed(2);

  // Send email via EmailJS if initialized (send once per calculation)
  if(typeof emailjs !== 'undefined' && EMAILJS_SERVICE_ID !== 'YOUR_SERVICE_ID' && EMAILJS_TEMPLATE_ID !== 'YOUR_TEMPLATE_ID'){
    const payload = {
      to_email: 'muvhangos@gmail.com',
      dailyRevenue: dailyRevenue.toFixed(2),
      monthlyRevenue: monthlyRevenue.toFixed(2)
    };
    emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, payload)
      .then(r => console.log('Revenue email sent', r.status, r.text))
      .catch(err => console.error('EmailJS error', err));
  } else {
    console.log('EmailJS not configured; calculation done locally.');
  }
}

/* -------------------------
   Boot: initialize on load
   ------------------------- */
(async function boot(){
  showAdminIfNeeded();
  // Initial quick-load: load feeds and start carousels
  await refreshAll();

  // periodic refresh
  setInterval(refreshAll, REFRESH_FEEDS_MS);

  // pause-on-hover is handled by onmouseenter/onmouseleave handlers on each carousel
})();
</script>
</body>
</html>
